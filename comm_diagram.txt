@startuml
  participant robot
  participant JHU_needle
  participant UI
  
  box trajcontrol
    participant keypress
    participant estimator
    participant controller
    participant save_file
  end box

  JHU_needle -> estimator: /needle/state/current_shape
  robot -> estimator: /stage/state/needle_pose
  estimator --> controller: /needle/state/jacobian

  keypress->controller: '/keyboard/key'
  JHU_needle -> controller: /needle/state/current_shape
  UI -> controller: /subject/state/skin_entry
  UI -> controller: /subject/state/target
  robot -> controller: /stage/state/needle_pose
  controller -> robot: /move_stage

  estimator -> save_file: /needle/state/jacobian
  controller -> save_file: /stage/control/cmd
  UI -> save_file: /subject/state/skin_entry
  UI -> save_file: /subject/state/target
  JHU_needle -> save_file: /needle/state/current_shape
  robot -> save_file: /stage/state/needle_pose

@enduml